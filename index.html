<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Lot Size Calculator</title>

<style>
body {
  font-family: Arial, sans-serif;
  background: #0f172a;
  color: #e5e7eb;
  padding: 20px;
}

.box {
  max-width: 420px;
  margin: auto;
  background: #020617;
  padding: 20px;
  border-radius: 10px;
}

h2 {
  text-align: center;
  margin-bottom: 15px;
}

label {
  display: block;
  margin-top: 10px;
  font-size: 14px;
}

input, select {
  width: 100%;
  padding: 12px;
  margin-top: 5px;
  border-radius: 6px;
  border: none;
  font-size: 16px;
}

.toggle {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-top: 15px;
  padding: 10px;
  background: #020617;
  border: 1px solid #1e293b;
  border-radius: 8px;
}

button {
  margin-top: 20px;
  width: 100%;
  padding: 12px;
  font-size: 16px;
  background: #22c55e;
  color: #022c22;
  border: none;
  border-radius: 8px;
}

.result {
  margin-top: 15px;
  font-size: 20px;
  font-weight: bold;
  text-align: center;
}

/* JOURNAL TABLE */
.table-wrap {
  overflow-x: auto;
  -webkit-overflow-scrolling: touch;
}

table {
  min-width: 900px;
  border-collapse: collapse;
  font-size: 14px;
}

td, th {
  white-space: nowrap;
  padding: 6px;
  border: 1px solid #1e293b;
  vertical-align: top;
}

/* PnL */
.pnl-input {
  width: 80px;
  font-weight: bold;
}

/* Notes */
textarea {
  min-width: 160px;
  min-height: 60px;
  resize: vertical;
  padding: 6px;
  border-radius: 6px;
  border: none;
  font-size: 14px;
}
</style>
</head>

<body>

<div style="text-align:center; margin-bottom:15px;">
  <button onclick="showCalculator()">Calculator</button>
  <button onclick="showJournal()">Journal</button>
</div>

<!-- CALCULATOR -->
<div class="box" id="calculatorPage">
<h2>Lot Size Calculator</h2>

<label>Asset</label>
<select id="asset">
  <option value="1">NASDAQ (USTECm)</option>
  <option value="1">S&P 500 (US500m)</option>
  <option value="1">US30 (US30m)</option>
  <option value="100">Gold (XAUUSDm)</option>
  <option value="5000">Silver (XAGUSDm)</option>
  <option value="1">BTCUSD</option>
  <option value="1">ETHUSD</option>
  <option value="1">SOLUSD</option>
</select>

<label>Entry Price</label>
<input type="number" id="entry" step="0.01">

<label>Stop Loss Price</label>
<input type="number" id="stop" step="0.01">

<div class="toggle">
  <span>Use Account Size & Risk %</span>
  <input type="checkbox" id="riskMode" onchange="toggleRiskMode()">
</div>

<div id="manualRisk">
  <label>Risk Amount ($)</label>
  <input type="number" id="riskAmount">
</div>

<div id="percentRisk" style="display:none;">
  <label>Account Balance</label>
  <input type="number" id="accountSize">
  <label>Risk %</label>
  <input type="number" id="riskPercent">
</div>

<button onclick="calculate()">Calculate Lot Size</button>
<div class="result" id="result"></div>
</div>

<!-- JOURNAL -->
<div class="box" id="journalPage" style="display:none;">
<h2>Trade Journal</h2>

<label>Select Month</label>
<select id="monthSelect" onchange="changeMonth(this.value)"></select>

<div id="statsBox" style="margin:10px 0; padding:10px; border:1px solid #1e293b; border-radius:8px;"></div>

<div class="table-wrap">
<table>
<thead>
<tr>
<th>Date</th><th>Asset</th><th>Risk</th><th>Lot</th>
<th>Result</th><th>PnL ($)</th><th>Notes</th><th>❌</th>
</tr>
</thead>
<tbody id="journalBody"></tbody>
</table>
</div>
</div>

<script>
let activeMonth = new Date().toISOString().slice(0,7);

function toggleRiskMode() {
  const p = document.getElementById("riskMode").checked;
  manualRisk.style.display = p ? "none" : "block";
  percentRisk.style.display = p ? "block" : "none";
}

function showCalculator() {
  calculatorPage.style.display = "block";
  journalPage.style.display = "none";
}

function showJournal() {
  calculatorPage.style.display = "none";
  journalPage.style.display = "block";
  loadMonthOptions();
  loadJournal();
}

function calculate() {
  const entry = parseFloat(document.getElementById("entry").value);
const stop = parseFloat(document.getElementById("stop").value);
  const vpp = +asset.value;

  if (!entry || !stop) return result.innerText="Enter entry & stop";

  const dist = Math.abs(entry - stop);
  let risk;

  if (riskMode.checked) {
    risk = accountSize.value * (riskPercent.value/100);
  } else {
    risk = +riskAmount.value;
  }

  const lot = risk / (dist * vpp);
  result.innerText = "Lot Size: " + lot.toFixed(2);

  saveTrade(entry, stop, risk, lot);
}

function saveTrade(entry, stop, risk, lot) {
  const j = JSON.parse(localStorage.tradingJournal||"{}");
  if (!j[activeMonth]) j[activeMonth]=[];

  j[activeMonth].push({
    date:new Date().toISOString().slice(0,10),
    asset:asset.options[asset.selectedIndex].text,
    risk, lot, result:"OPEN", pnl:null, notes:""
  });

  localStorage.tradingJournal=JSON.stringify(j);
}

function loadJournal() {
  const j = JSON.parse(localStorage.tradingJournal||"{}");
  const t = j[activeMonth]||[];
  journalBody.innerHTML="";

  t.forEach((x,i)=>{
    journalBody.innerHTML+=`
<tr>
<td>${x.date}</td>
<td>${x.asset}</td>
<td>$${x.risk}</td>
<td>${x.lot.toFixed(2)}</td>
<td>
<select onchange="update(${i},'result',this.value)">
<option ${x.result=="OPEN"?"selected":""}>OPEN</option>
<option ${x.result=="WIN"?"selected":""}>WIN</option>
<option ${x.result=="LOSS"?"selected":""}>LOSS</option>
<option ${x.result=="BE"?"selected":""}>BE</option>
</select>
</td>
<td>
<input class="pnl-input" type="number"
value="${x.pnl??""}"
onchange="update(${i},'pnl',this.value);loadJournal()"
style="color:${Number(x.pnl)>0?'#22c55e':Number(x.pnl)<0?'#ef4444':'#e5e7eb'}">
</td>
<td>
<textarea onchange="update(${i},'notes',this.value)">${x.notes}</textarea>
</td>
<td><button onclick="del(${i})">❌</button></td>
</tr>`;
  });

  calcStats();
}

function update(i, f, v) {
  const j = JSON.parse(localStorage.tradingJournal || "{}");

  if (f === "pnl") {
    j[activeMonth][i].pnl = v === "" ? null : parseFloat(v);
  } else {
    j[activeMonth][i][f] = v;
  }

  localStorage.tradingJournal = JSON.stringify(j);
}

function del(i){
  if(!confirm("Delete trade?"))return;
  const j=JSON.parse(localStorage.tradingJournal||"{}");
  j[activeMonth].splice(i,1);
  localStorage.tradingJournal=JSON.stringify(j);
  loadJournal();
}

function loadMonthOptions(){
  const j=JSON.parse(localStorage.tradingJournal||"{}");
  monthSelect.innerHTML="";
  Object.keys(j).sort().reverse().forEach(m=>{
    monthSelect.innerHTML+=`<option ${m==activeMonth?"selected":""}>${m}</option>`;
  });
}

function changeMonth(m){activeMonth=m;loadJournal();}

function calcStats(){
  const j=JSON.parse(localStorage.tradingJournal||"{}");
  const t=j[activeMonth]||[];
  let w=0,l=0,p=0;
  t.forEach(x=>{if(x.result=="WIN")w++;if(x.result=="LOSS")l++;p+=x.pnl||0});
  statsBox.innerHTML=`Trades:${t.length}<br>Wins:${w} Losses:${l}<br>Net PnL:$${p.toFixed(2)}`;
}
</script>

</body>
</html>